<!DOCTYPE html>
<html>
<head>
    <title>Power BI Dashboard Experiment</title>
    <script type="text/javascript">
        let startTime, endTime, clickCount, currentQuestion = 0;
        const questions = [
            "Welcher Artikel hat den höchsten Umsatz in der Kategorie Clothing und wie viel Umsatz ist das?",
            "Hier kommt Ihre zweite Frage.",
            "Hier kommt Ihre dritte Frage.",
            "Hier kommt Ihre vierte Frage."
        ];

        document.addEventListener('DOMContentLoaded', (event) => {
            document.getElementById('startButton').addEventListener('click', startExperiment);
            document.getElementById('stopButton').addEventListener('click', stopExperiment);
            document.getElementById('nextButton').addEventListener('click', nextQuestion);
            document.addEventListener('click', recordClick);
            updateQuestion();
        });

        function startExperiment() {
            startTime = new Date();
            clickCount = 0;
            document.getElementById('question').style.display = 'block';
            document.getElementById('startButton').style.display = 'none';
        }

        function stopExperiment() {
            endTime = new Date();
            let duration = (endTime - startTime) / 1000;
            let answer = document.getElementById('answerInput').value;
            let currentQuestionText = questions[currentQuestion];

            console.log("Aktuelle Frage:", questions[currentQuestion]);
            console.log("Startzeit:", startTime);
            console.log("Endzeit:", endTime);
            console.log("Dauer:", duration);
            console.log("Antwort:", answer);
            console.log("Klickanzahl:", clickCount);
            
            sendDataToGoogleSheet(currentQuestionText, startTime, endTime, duration, answer, clickCount);
            document.getElementById('question').style.display = 'none';
            document.getElementById('answerInput').value = '';
            document.getElementById('nextButton').style.display = 'block';
        }

        function nextQuestion() {
            if (currentQuestion < questions.length - 1) {
                currentQuestion++;
                updateQuestion();
                document.getElementById('nextButton').style.display = 'none';
                document.getElementById('startButton').style.display = 'block';
            } else {
                alert('Experiment abgeschlossen. Vielen Dank für Ihre Teilnahme!');
            }
        }

        function updateQuestion() {
            document.getElementById('questionText').textContent = questions[currentQuestion];
        }

        function recordClick() {
            clickCount++;
        }

        function sendDataToGoogleSheet(question, startTime, endTime, duration, answer, clickCount) {
            console.log("Gesendete Daten:", { question, startTime, endTime, duration, answer, clickCount });
            fetch('https://script.google.com/macros/s/AKfycbz9n1xrZAkx599km-5cDlQ5ZZjbIllhtfoVnW7iPSu8n-zA_yi3QkbXcTrWiFo2o2gqLA/exec', {
                method: 'POST',
                mode: 'no-cors',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    startTime: startTime.toISOString(),
                    endTime: endTime.toISOString(),
                    duration: duration,
                    answer: answer,
                    clickCount: clickCount,
                    question: question
                })
            })
            .then(response => console.log('Daten gesendet'))
            .catch(error => console.error('Error:', error));
        }
    </script>
</head>
<body>
    <h1>Power BI Dashboard Experiment</h1>

    <button id="startButton">Start</button>
    <div id="question" style="display:none;">
        <p id="questionText">Hier kommt Ihre Frage.</p>
        <input type="text" id="answerInput" placeholder="Antwort eingeben">
        <button id="stopButton">Stopp</button>
    </div>
    <button id="nextButton" style="display:none;">Weiter</button>

    <!-- Ihr eingebettetes Power BI-Dashboard -->
    <iframe id="powerbiFrame" title="Experiment_v1" width="800" height="600" src="https://app.powerbi.com/view?r=eyJrIjoiNzgwYzI1YjItNjI3YS00NzEyLWIzNDUtZWFlNzBhMDZiNjgxIiwidCI6ImFkNTY1Mjk4LTg5ZDMtNDYwYy1hZTNjLWM3N2E3ZTlhMjFlOSJ9" frameborder="0" allowFullScreen="true"></iframe>

</body>
</html>
